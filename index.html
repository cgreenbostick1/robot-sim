<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Human-Robot EEG Simulation</title>
  <style>
    body { margin:0; display:flex; height:100vh; font-family:Arial,Helvetica,sans-serif; }
    #left { flex: 1; display:flex; flex-direction:column; }
    #canvasContainer { flex: 1; background:#eef; }
    #controls { padding:10px; background:#f4f4f4; border-top:1px solid #ddd; }
    #chartContainer { width:420px; padding:10px; background:#fff; border-left:1px solid #ddd; }
    canvas { display:block; }
  </style>
</head>
<body>
  <div id="left">
    <div id="canvasContainer"></div>
    <div id="controls">
      <label>Task Difficulty: <input id="difficulty" type="range" min="0" max="3" step="0.1" value="1"></label>
      <button id="toggle">Pause Simulation</button>
    </div>
  </div>

  <div id="chartContainer">
    <h4>Simulated EEG / Affect Signals</h4>
    <canvas id="chart" width="400" height="300"></canvas>
    <p style="font-size:13px;color:#555;">Blue=Focus | Orange=Stress | Green=Engagement</p>
  </div>

  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  // --- Setup 3D Scene ---
  const container = document.getElementById('canvasContainer');
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);
  camera.position.set(3, 2, 5);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  container.appendChild(renderer.domElement);

  function resize(){
    const w = container.clientWidth, h = container.clientHeight;
    renderer.setSize(w, h); camera.aspect = w/h; camera.updateProjectionMatrix();
  }
  new ResizeObserver(resize).observe(container);

  scene.add(new THREE.AmbientLight(0x888888));
  const light = new THREE.DirectionalLight(0xffffff, 1); light.position.set(5,10,5);
  scene.add(light);

  // Simple robot: base + arm + gripper
  const base = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.2,0.8), new THREE.MeshStandardMaterial({color:0x2b6f77}));
  base.position.y=0.1; scene.add(base);
  const arm = new THREE.Mesh(new THREE.BoxGeometry(0.2,1.5,0.2), new THREE.MeshStandardMaterial({color:0xe07a5f}));
  arm.position.y=0.75; base.add(arm);
  const gripper = new THREE.Mesh(new THREE.BoxGeometry(0.6,0.1,0.2), new THREE.MeshStandardMaterial({color:0x6f6f6f}));
  gripper.position.y=0.9; arm.add(gripper);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);

  // --- EEG Chart Setup ---
  const ctx = document.getElementById('chart').getContext('2d');
  const MAX_POINTS = 60;
  const chart = new Chart(ctx, {
    type:'line',
    data:{
      labels:Array(MAX_POINTS).fill(""),
      datasets:[
        {label:'Focus', data:Array(MAX_POINTS).fill(0.5), borderColor:'blue', fill:false},
        {label:'Stress', data:Array(MAX_POINTS).fill(0.5), borderColor:'orange', fill:false},
        {label:'Engagement', data:Array(MAX_POINTS).fill(0.5), borderColor:'green', fill:false}
      ]
    },
    options:{animation:false, scales:{y:{min:0,max:1}}, plugins:{legend:{display:true}}}
  });

  // --- Simulation Logic ---
  let running = true;
  document.getElementById('toggle').onclick=()=>{
    running=!running;
    document.getElementById('toggle').textContent = running ? "Pause Simulation":"Resume Simulation";
  };

  function simulateEEG(t,difficulty){
    const focus = 0.5 + 0.3*Math.sin(t*0.002) - 0.05*difficulty;
    const stress = 0.4 + 0.4*Math.cos(t*0.0015 + difficulty);
    const engage= 0.6 + 0.2*Math.sin(t*0.001*difficulty + 2);
    return [Math.max(0,Math.min(1,focus)), Math.max(0,Math.min(1,stress)), Math.max(0,Math.min(1,engage))];
  }

  function animate(time){
    requestAnimationFrame(animate);
    if(running){
      const diff = parseFloat(document.getElementById('difficulty').value);
      base.rotation.y += 0.005*diff;
      arm.rotation.z = 0.3*Math.sin(time*0.001*diff);
      gripper.rotation.x = 0.2*Math.sin(time*0.002*diff);

      const [f,s,e] = simulateEEG(time,diff);
      chart.data.datasets[0].data.push(f);
      chart.data.datasets[1].data.push(s);
      chart.data.datasets[2].data.push(e);
      chart.data.datasets.forEach(ds=>{ if(ds.data.length>MAX_POINTS) ds.data.shift(); });
      chart.update("none");
    }
    renderer.render(scene,camera);
  }
  animate(0);
  </script>
</body>
</html>

