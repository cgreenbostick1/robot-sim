<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Human-Robot EEG Simulation</title>
  <style>
    body { margin:0; display:flex; height:100vh; font-family:Arial,Helvetica,sans-serif; background:#fff; }

    /* LEFT: big chart area (white) */
    #chartPane{
      flex:1; display:flex; flex-direction:column;
      padding:16px; gap:8px; background:#fff; min-width:0;
    }
    #chartPane h4{ margin:0; color:#222; }
    #legend{ margin:0; color:#555; font-size:13px; }
    #chartWrap{
      flex:1; background:#fff; border:1px solid #e5e7eb;
      border-radius:8px; padding:10px; overflow:hidden;
    }
    #chart{ background:#fff; display:block; }

    /* RIGHT: fixed sidebar for 3D + controls */
    #right{
      width:420px; min-width:420px; display:flex; flex-direction:column;
      background:#fff; border-left:1px solid #ddd;
    }
    #canvasContainer{ flex:1; background:#eef; }
    #controls{ padding:10px; background:#f4f4f4; border-top:1px solid #ddd; }

    canvas { display:block; }
  </style>
</head>
<body>

  <!-- LEFT (chart) -->
  <div id="chartPane">
    <h4>Simulated EEG / Affect Signals</h4>
    <div id="chartWrap">
      <canvas id="chart"></canvas>
    </div>
    <p id="legend">
      Blue = Focus | Orange = Stress | Green = Engagement |
      Purple = Interest | Red = Excitement | Teal = Relaxation
    </p>
  </div>

  <!-- RIGHT (3D headset + controls) -->
  <div id="right">
    <div id="canvasContainer"></div>
    <div id="controls">
      <label>Task Difficulty:
        <input id="difficulty" type="range" min="0" max="3" step="0.1" value="1">
      </label>
      <button id="toggle">Pause Simulation</button>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>

  <script>
  /* --------------------- THREE.JS (RIGHT SIDEBAR) --------------------- */
  const container = document.getElementById('canvasContainer');
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);

  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setPixelRatio(window.devicePixelRatio || 1);
  container.appendChild(renderer.domElement);

  camera.position.set(4,3,6);
  camera.lookAt(0,1,0);
  renderer.setClearColor(0xf0f0f0);

  function resize3D(){
    const w = container.clientWidth, h = container.clientHeight || 1;
    renderer.setSize(w, h, false);
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
  }
  resize3D();
  if (window.ResizeObserver) new ResizeObserver(resize3D).observe(container);
  window.addEventListener('resize', resize3D);

  // Lights
  scene.add(new THREE.AmbientLight(0x888888));
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5,10,5); scene.add(light);

  // Simple "headset/robot" stand-in
  const base = new THREE.Mesh(new THREE.BoxGeometry(1,0.2,1), new THREE.MeshStandardMaterial({color:0x2b6f77}));
  base.position.y = 0.1; scene.add(base);
  const arm = new THREE.Mesh(new THREE.BoxGeometry(0.3,1.5,0.3), new THREE.MeshStandardMaterial({color:0x1565c0}));
  arm.position.y = 0.75; base.add(arm);
  const gripper = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.1,0.2), new THREE.MeshStandardMaterial({color:0x222222}));
  gripper.position.y = 0.9; arm.add(gripper);

  if (THREE.OrbitControls) {
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    (function tick(){ controls.update(); requestAnimationFrame(tick); })();
  }

  /* --------------------- CHART (LEFT BIG PANE) --------------------- */
  const chartCanvas = document.getElementById('chart');
  const MAX_POINTS = 60;
  const chart = new Chart(chartCanvas.getContext('2d'), {
    type: 'line',
    data: {
      labels: Array(MAX_POINTS).fill(""),
      datasets: [
        { label: 'Focus',      data: Array(MAX_POINTS).fill(0.5), borderColor:'blue',      fill:false, tension:0.2 },
        { label: 'Stress',     data: Array(MAX_POINTS).fill(0.5), borderColor:'orange',    fill:false, tension:0.2 },
        { label: 'Engagement', data: Array(MAX_POINTS).fill(0.5), borderColor:'green',     fill:false, tension:0.2 },
        { label: 'Interest',   data: Array(MAX_POINTS).fill(0.5), borderColor:'#7e57c2',   fill:false, tension:0.2 }, // purple
        { label: 'Excitement', data: Array(MAX_POINTS).fill(0.5), borderColor:'#e53935',   fill:false, tension:0.2 }, // red
        { label: 'Relaxation', data: Array(MAX_POINTS).fill(0.5), borderColor:'#00897b',   fill:false, tension:0.2 }  // teal
      ]
    },
    options: {
      responsive: false, maintainAspectRatio: false, animation: false,
      scales: { y: { min: 0, max: 1 } },
      plugins: { legend: { display: true } }
    }
  });

  function sizeChart(){
    const wrap = document.getElementById('chartWrap');
    chartCanvas.width  = wrap.clientWidth  - 20;
    chartCanvas.height = wrap.clientHeight - 20;
    chart.resize();
  }
  sizeChart();
  if (window.ResizeObserver) new ResizeObserver(sizeChart).observe(document.getElementById('chartWrap'));
  window.addEventListener('resize', sizeChart);

  /* --------------------- SIMULATION --------------------- */
  let running = true;
  document.getElementById('toggle').onclick = () => {
    running = !running;
    document.getElementById('toggle').textContent = running ? "Pause Simulation" : "Resume Simulation";
  };

  const clamp01 = v => Math.max(0, Math.min(1, v));

  // 6 signals: Focus, Stress, Engagement, Interest, Excitement, Relaxation
  function simulateSignals(t, difficulty){
    const focus      = clamp01(0.5 + 0.3*Math.sin(t*0.002) - 0.05*difficulty);
    const stress     = clamp01(0.4 + 0.4*Math.cos(t*0.0015 + difficulty));
    const engage     = clamp01(0.6 + 0.2*Math.sin(t*0.001*difficulty + 2));
    const interest   = clamp01(0.5 + 0.25*Math.sin(t*0.0013 + difficulty*0.5) + 0.10*(engage - stress));
    const excitement = clamp01(0.5 + 0.35*Math.sin(t*0.003 + 1.2) + 0.05*difficulty);
    const relaxation = clamp01(0.6 - 0.30*stress + 0.10*(1 - focus));
    return [focus, stress, engage, interest, excitement, relaxation];
  }

  function animate(time){
    requestAnimationFrame(animate);
    if (running){
      const diff = parseFloat(document.getElementById('difficulty').value);

      // 3D motion
      base.rotation.y += 0.005 * diff;
      arm.rotation.z   = 0.3 * Math.sin(time * 0.001 * diff);
      gripper.rotation.x = 0.2 * Math.sin(time * 0.002 * diff);

      // Update all 6 chart series
      const values = simulateSignals(time, diff);
      chart.data.datasets.forEach((ds, i) => {
        ds.data.push(values[i]);
        if (ds.data.length > MAX_POINTS) ds.data.shift();
      });
      chart.update("none");
    }
    renderer.render(scene, camera);
  }
  animate(0);
  </script>
</body>
</html>


